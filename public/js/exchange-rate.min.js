document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".fetch-exchange-rate").forEach(r=>{r.addEventListener("click",function(){let l=document.querySelector(".exchange-rate-field");var e;l&&(e=l.dataset.apiUrl||"https://open.er-api.com/v6/latest/CNY",l.setAttribute("placeholder","Chargement du taux..."),l.value="",l.disabled=!0,r.disabled=!0,r.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Chargement...',fetch(e).then(e=>{if(e.ok)return e.json();throw new Error("Erreur réseau")}).then(e=>{if(!(e&&e.rates&&e.rates.MGA))throw new Error("Données de taux de change non disponibles");l.value=e.rates.MGA.toFixed(6);var r,t,a=l.closest(".mb-3").querySelector(".form-text");a&&(t=new Date,(r=document.createElement("div")).className="mt-2 small text-success",r.innerHTML="Taux récupéré le "+t.toLocaleString()+"<br>Source: "+(e.provider||"exchangerate-api.com"),(t=a.querySelector(".mt-2.small.text-success"))?a.replaceChild(r,t):a.appendChild(r))}).catch(e=>{console.error("Erreur lors de la récupération du taux de change:",e),l.value="",l.setAttribute("placeholder","Erreur lors de la récupération du taux");var r,t,e=l.closest(".mb-3").querySelector(".form-text");e&&((r=document.createElement("div")).className="mt-2 small text-danger",r.textContent="Erreur: Impossible de récupérer le taux de change. Veuillez réessayer plus tard.",(t=e.querySelector(".mt-2.small.text-danger"))?e.replaceChild(r,t):e.appendChild(r))}).finally(()=>{l.disabled=!1,r.disabled=!1,r.innerHTML="Récupérer le taux actuel",l.focus()}))})})});