document.addEventListener("DOMContentLoaded",function(){document.querySelector("#quote_productType"),document.querySelector("#otherProductTypeContainer");var e=document.querySelector("#quoteForm");let t=document.querySelector("#loader"),l=document.querySelector(".shipping-method-container");function o(){console.log("checkServicesSelection called");var e=document.querySelectorAll('input[name="quote[services][]"]');let t,o;e.forEach(function(e){console.log("Checkbox value:",e.value),"Sourcing et négociation"===e.value&&(t=e,console.log("Sourcing checkbox found, checked:",e.checked)),"Transport et logistique"===e.value&&(o=e,console.log("Logistics checkbox found, checked:",e.checked))});e=t&&t.checked,console.log("Sourcing selected:",e),o&&(e?(o.disabled=!1,o.parentElement.classList.remove("disabled-option"),console.log("Logistics checkbox enabled")):(o.disabled=!0,o.checked=!1,o.parentElement.classList.add("disabled-option"),console.log("Logistics checkbox disabled"))),e=o&&o.checked;l&&(e?(l.style.display="block",document.querySelectorAll('input[name="quote[shippingMethod]"]').forEach(function(e){e.required=!0})):(l.style.display="none",document.querySelectorAll('input[name="quote[shippingMethod]"]').forEach(function(e){e.checked=!1,e.required=!1})))}function u(e){if(e){var o=e.closest(".photo-upload-container");if(o){let t=o.querySelector(".product-photo-preview");t&&e.addEventListener("change",function(){var e;this.files&&this.files[0]?((e=new FileReader).onload=function(e){t.src=e.target.result,t.style.display="block"},e.readAsDataURL(this.files[0])):(t.src="#",t.style.display="none")})}}}console.log("Document loaded"),console.log("initializeServiceOptions called"),(n=document.querySelector('input[name="quote[services][]"][value="Transport et logistique"]'))?(n.disabled=!0,n.parentElement.classList.add("disabled-option"),console.log("Logistics checkbox initially disabled")):console.log("Logistics checkbox not found"),o(),document.querySelectorAll('input[name="quote[services][]"]').forEach(function(e){console.log("Adding event listener to checkbox:",e.value),e.addEventListener("change",function(){console.log("Checkbox changed:",this.value,"checked:",this.checked),o()})}),l?(console.log("Shipping method container found"),l.style.display="none",document.querySelectorAll('input[name="quote[shippingMethod]"]').forEach(function(e){e.required=!1}),o()):console.log("Shipping method container not found"),document.querySelectorAll(".form-control-file").forEach(function(e){u(e)}),document.addEventListener("change",function(e){if(e.target&&"file"===e.target.type&&e.target.classList.contains("form-control-file")){var o=e.target.closest(".photo-upload-container");if(o){let t=o.querySelector(".product-photo-preview");t&&(e.target.files&&e.target.files[0]?((o=new FileReader).onload=function(e){t.src=e.target.result,t.style.display="block"},o.readAsDataURL(e.target.files[0])):(t.src="#",t.style.display="none"))}}});var n=document.querySelector(".add-item-btn");let p=document.querySelector(".quote-items-wrapper");function m(){var e=document.querySelectorAll(".quote-item"),t=document.querySelectorAll(".remove-item");e.length<=1?t.forEach(function(e){e.style.display="none"}):t.forEach(function(e){e.style.display="block"})}n&&p&&n.addEventListener("click",function(){var e=document.querySelectorAll(".quote-item");if(0<e.length){let l=e[0].cloneNode(!0),n=parseInt(p.dataset.index);l.querySelectorAll("input, select, textarea").forEach(function(e){var o=e.id,t=e.name;if(o){let t=o.replace(/\d+/,n);e.id=t,l.querySelectorAll(`label[for="${o}"]`).forEach(function(e){e.setAttribute("for",t)})}t&&(o=t.replace(/\[\d+\]/,`[${n}]`),e.name=o),"file"!==e.type&&("select-one"===e.type?e.selectedIndex=0:e.value="")});l.querySelectorAll("div[id]").forEach(function(e){var t=e.id;t&&(t=t.replace(/\d+/,n),e.id=t)});var e=l.querySelector(".product-photo-preview"),e=(e&&(e.src="#",e.style.display="none"),l.querySelector(".other-product-type-container")),e=(e&&(e.style.display="none",e=e.querySelector("input"))&&(e.required=!1),p.appendChild(l),l.querySelector(".form-control-file"));e&&u(e),p.dataset.index=n+1}else{var t,o,l,e=p.dataset.prototype,n=parseInt(p.dataset.index),e=e.replace(/__name__/g,n),c=document.createElement("div"),i=(c.classList.add("quote-item"),c.innerHTML=`
                    <span class="remove-item"><i class="fas fa-times-circle"></i></span>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="photo-container">
                                <div class="photo-upload-container">
                                    <!-- Le contenu sera ajouté dynamiquement -->
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="row">
                                <!-- Le contenu sera ajouté dynamiquement -->
                            </div>
                        </div>
                    </div>
                `,p.appendChild(c),document.createElement("div")),e=(i.innerHTML=e,i.querySelector('div[id$="_photoFile"]')),r=i.querySelector('div[id$="_productType"]'),a=i.querySelector('div[id$="_quantity"]'),d=i.querySelector('div[id$="_budget"]'),i=i.querySelector('div[id$="_description"]'),s=(e&&(o=c.querySelector(".photo-upload-container"))&&(e=e.querySelector('input[type="file"]'))&&(e.className="form-control-file d-none",(t=document.createElement("label")).setAttribute("for",e.id),t.className="upload-label",(l=document.createElement("div")).className="photo-upload-icon",l.innerHTML='<i class="fas fa-camera"></i>',(s=document.createElement("span")).textContent="Cliquez pour ajouter une photo",t.appendChild(l),t.appendChild(s),(l=document.createElement("img")).src="#",l.className="product-photo-preview",l.alt="Aperçu de la photo",o.appendChild(t),o.appendChild(e),o.appendChild(l),u(e)),c.querySelector(".col-md-8 .row"));s&&(r&&((t=document.createElement("div")).className="col-md-4 mb-3",t.appendChild(r),s.appendChild(t)),a&&((o=document.createElement("div")).className="col-md-4 mb-3",o.appendChild(a),s.appendChild(o)),d&&((l=document.createElement("div")).className="col-md-4 mb-3",l.appendChild(d),s.appendChild(l)),i)&&((e=document.createElement("div")).className="col-12 mb-3",e.appendChild(i),s.appendChild(e)),p.dataset.index=n+1}m()}),document.addEventListener("click",function(e){var t;e.target&&(e.target.classList.contains("remove-item")||e.target.closest(".remove-item"))&&(document.querySelectorAll(".quote-item").length<=1?alert("Vous ne pouvez pas supprimer ce produit car au moins un produit est requis."):(e=e.target.closest(".quote-item"))&&(e.remove(),(e=document.querySelectorAll(".quote-item")).forEach(function(l,n){l.querySelectorAll("input, select, textarea").forEach(function(e){var o=e.id,t=e.name;if(o){let t=o.replace(/\d+/,n);e.id=t,l.querySelectorAll(`label[for="${o}"]`).forEach(function(e){e.setAttribute("for",t)})}t&&(o=t.replace(/\[\d+\]/,`[${n}]`),e.name=o)}),l.querySelectorAll("div[id]").forEach(function(e){var t=e.id;t&&(t=t.replace(/\d+/,n),e.id=t)})}),(t=document.querySelector(".quote-items-wrapper"))&&(t.dataset.index=e.length),m()))}),m(),e&&e.addEventListener("submit",function(e){if(l&&"block"===l.style.display){if(!Array.from(document.querySelectorAll('input[name="quote[shippingMethod][]"]')).some(e=>e.checked))return e.preventDefault(),alert("Veuillez sélectionner une méthode d'envoi."),l.scrollIntoView({behavior:"smooth",block:"center"}),!1}else document.querySelectorAll('input[name="quote[shippingMethod][]"]').forEach(function(e){e.required=!1});e=document.querySelector("#submitButton");e&&(e.disabled=!0),t&&(t.style.display="flex")})});